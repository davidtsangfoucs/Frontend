{"ast":null,"code":"var _jsxFileName = \"/Users/david/Documents/GitHub/web-api/client/src/component/GoogleLogin.js\",\n  _s = $RefreshSig$();\nimport { useEffect } from 'react';\nimport axios from '../commons/axios';\nimport { baseURL } from '../commons/helper';\nimport jwt_decode from \"jwt-decode\";\nimport { useNavigate } from 'react-router-dom';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nfunction GoogleLogin() {\n  _s();\n  const navigate = useNavigate();\n  async function handleCallbackResponse(response) {\n    console.log(\"Encoded JWT ID token\" + response.credential);\n    var userObject = jwt_decode(response.credential);\n    console.log(\"userObject\", userObject);\n    try {\n      // Send a request to your server to verify the token\n      const verificationResponse = await axios.post(`${baseURL}/verify-id-token`, {\n        idToken: response.credential\n      });\n\n      // Check if the token is verified\n      if (!verificationResponse.data.verified) {\n        throw new Error('Token verification failed');\n      }\n      let RegisFormData = {};\n      let responseCheckUser;\n      try {\n        responseCheckUser = await axios.get(`${baseURL}/get-employees-accounts/${response.clientId}`);\n      } catch (error) {\n        console.log('User not found', error.message);\n      }\n      if (!responseCheckUser || !responseCheckUser.data) {\n        // Create a new user\n        RegisFormData = {\n          fullName: userObject.name,\n          email: userObject.email,\n          password: 'No password number',\n          confirmPassword: 'No password number',\n          dateOfBirth: \"No date of birth\",\n          gender: \"No Gender\",\n          // If Google API provides it\n          phoneNumber: 'No phone number',\n          address: 'No address number',\n          state: \"verification\",\n          premission: \"Public User\",\n          department: \"No Department\",\n          employeeID: response.clientId,\n          hkID: 'No HKID number'\n        };\n\n        // Register the new user\n        let registrationResponse = await registerUser(RegisFormData);\n\n        // Save the JWT to local storage\n        localStorage.setItem('auth-token', registrationResponse.data.token);\n        localStorage.setItem('premission', \"Public User\");\n        localStorage.setItem('user-id', response.data.employeeID);\n        localStorage.setItem('employeeID', response.data.employeeID);\n        localStorage.setItem('obj-id', response.data._id);\n        const logoutTime = Date.now() + 60 * 60 * 1000; // 60 minutes\n        localStorage.setItem('logoutTime', logoutTime.toString());\n        alert('Login successfully');\n        navigate('/');\n      } else {\n        // The user already exists\n        let UserData = responseCheckUser.data;\n\n        // Save the JWT to local storage\n        localStorage.setItem('auth-token', UserData.token);\n        localStorage.setItem('premission', UserData.employee.premission);\n        navigate('/');\n      }\n    } catch (err) {\n      console.error(err);\n    }\n  }\n  const registerUser = async RegisFormData => {\n    try {\n      const response = await axios.post(`${baseURL}/create-account`, {\n        // Include other registration data as needed\n        ...RegisFormData\n      });\n      console.log('Registration successful:', response.data);\n      alert('Registration successful!');\n      // Handle successful registration\n\n      // Set isRegistering back to false after the registration process is completed\n      // setIsRegistering(false);\n    } catch (error) {\n      console.error('Registration failed:', error.response.data);\n      alert('Registration failed!');\n      // Handle registration failure\n    }\n  };\n\n  // Init Google client\n  useEffect(() => {\n    /* global google */\n    google.accounts.id.initialize({\n      client_id: \"1061523075573-n537pria7u9k24et8osc54cop29krk3c.apps.googleusercontent.com\",\n      callback: handleCallbackResponse\n    });\n    google.accounts.id.renderButton(document.getElementById(\"signInDiv\"), {\n      theme: \"outline\",\n      size: \"large\"\n    });\n  }, []);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"App\",\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      id: \"signInDiv\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 119,\n      columnNumber: 13\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 118,\n    columnNumber: 9\n  }, this);\n}\n_s(GoogleLogin, \"0pNeyzXk/ByIxyERsdaIrG6js9s=\", false, function () {\n  return [useNavigate];\n});\n_c = GoogleLogin;\nexport default GoogleLogin;\nvar _c;\n$RefreshReg$(_c, \"GoogleLogin\");","map":{"version":3,"names":["useEffect","axios","baseURL","jwt_decode","useNavigate","jsxDEV","_jsxDEV","GoogleLogin","_s","navigate","handleCallbackResponse","response","console","log","credential","userObject","verificationResponse","post","idToken","data","verified","Error","RegisFormData","responseCheckUser","get","clientId","error","message","fullName","name","email","password","confirmPassword","dateOfBirth","gender","phoneNumber","address","state","premission","department","employeeID","hkID","registrationResponse","registerUser","localStorage","setItem","token","_id","logoutTime","Date","now","toString","alert","UserData","employee","err","google","accounts","id","initialize","client_id","callback","renderButton","document","getElementById","theme","size","className","children","fileName","_jsxFileName","lineNumber","columnNumber","_c","$RefreshReg$"],"sources":["/Users/david/Documents/GitHub/web-api/client/src/component/GoogleLogin.js"],"sourcesContent":["import { useEffect } from 'react';\nimport axios from '../commons/axios';\nimport { baseURL } from '../commons/helper';\nimport jwt_decode from \"jwt-decode\"\nimport { useNavigate } from 'react-router-dom';\n\n\nfunction GoogleLogin() {\n    const navigate = useNavigate();\n\n    async function handleCallbackResponse(response) {\n        console.log(\"Encoded JWT ID token\" + response.credential);\n        var userObject = jwt_decode(response.credential);\n        console.log(\"userObject\", userObject);\n        try {\n            // Send a request to your server to verify the token\n            const verificationResponse = await axios.post(`${baseURL}/verify-id-token`, {\n                idToken: response.credential,\n            });\n\n            // Check if the token is verified\n            if (!verificationResponse.data.verified) {\n                throw new Error('Token verification failed');\n            }\n\n            let RegisFormData = {};\n            let responseCheckUser;\n\n            try {\n                responseCheckUser = await axios.get(`${baseURL}/get-employees-accounts/${response.clientId}`);\n            } catch (error) {\n                console.log('User not found', error.message);\n            }\n\n\n            if (!responseCheckUser || !responseCheckUser.data) {\n                // Create a new user\n                RegisFormData = {\n                    fullName: userObject.name,\n                    email: userObject.email,\n                    password: 'No password number',\n                    confirmPassword: 'No password number',\n                    dateOfBirth: \"No date of birth\",\n                    gender: \"No Gender\", // If Google API provides it\n                    phoneNumber: 'No phone number',\n                    address: 'No address number',\n                    state: \"verification\",\n                    premission: \"Public User\",\n                    department: \"No Department\",\n                    employeeID: response.clientId,\n                    hkID: 'No HKID number',\n                };\n\n                // Register the new user\n                let registrationResponse = await registerUser(RegisFormData);\n\n                // Save the JWT to local storage\n                localStorage.setItem('auth-token', registrationResponse.data.token);\n                localStorage.setItem('premission', \"Public User\");\n                localStorage.setItem('user-id', response.data.employeeID);\n                localStorage.setItem('employeeID', response.data.employeeID);\n                localStorage.setItem('obj-id', response.data._id);\n                const logoutTime = Date.now() + 60 * 60 * 1000; // 60 minutes\n                localStorage.setItem('logoutTime', logoutTime.toString());\n                alert('Login successfully');\n                navigate('/')\n            } else {\n                // The user already exists\n                let UserData = responseCheckUser.data;\n\n                // Save the JWT to local storage\n                localStorage.setItem('auth-token', UserData.token);\n                localStorage.setItem('premission', UserData.employee.premission);\n                navigate('/')\n            }\n        } catch (err) {\n            console.error(err);\n        }\n    }\n\n    const registerUser = async (RegisFormData) => {\n        try {\n            const response = await axios.post(`${baseURL}/create-account`, {\n                // Include other registration data as needed\n                ...RegisFormData\n            });\n\n            console.log('Registration successful:', response.data);\n            alert('Registration successful!');\n            // Handle successful registration\n\n            // Set isRegistering back to false after the registration process is completed\n            // setIsRegistering(false);\n\n\n        } catch (error) {\n            console.error('Registration failed:', error.response.data);\n            alert('Registration failed!');\n            // Handle registration failure\n        }\n    };\n\n    // Init Google client\n    useEffect(() => {\n        /* global google */\n        google.accounts.id.initialize({\n            client_id: \"1061523075573-n537pria7u9k24et8osc54cop29krk3c.apps.googleusercontent.com\",\n            callback: handleCallbackResponse\n        });\n        google.accounts.id.renderButton(\n            document.getElementById(\"signInDiv\"),\n            { theme: \"outline\", size: \"large\" }\n        )\n    }, []);\n\n\n    return (\n        <div className=\"App\">\n            <div id=\"signInDiv\"></div>\n        </div>\n    );\n}\n\nexport default GoogleLogin;\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}