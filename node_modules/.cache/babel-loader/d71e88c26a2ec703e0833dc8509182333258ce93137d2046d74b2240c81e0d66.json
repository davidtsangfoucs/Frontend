{"ast":null,"code":"var _jsxFileName = \"/Users/david/Documents/GitHub/web-api/client/src/component/GoogleLogin.js\",\n  _s = $RefreshSig$();\nimport { useEffect } from 'react';\nimport axios from '../commons/axios';\nimport { baseURL } from '../commons/helper';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nasync function fetchUserProfile(idToken) {\n  try {\n    const response = await axios.get('https://people.googleapis.com/v1/people/me', {\n      params: {\n        personFields: 'names'\n      },\n      headers: {\n        Authorization: `Bearer ${idToken}`\n      }\n    });\n\n    // Extract the desired information from the response\n    const email = response.data.emailAddresses[0].value;\n    const gender = response.data.genders[0].value;\n    const name = response.data.names[0].displayName;\n    return {\n      email,\n      gender,\n      name\n    };\n  } catch (error) {\n    console.error('Failed to fetch user profile:', error);\n    throw error;\n  }\n}\nfunction GoogleLogin() {\n  _s();\n  async function handleCallbackResponse(response) {\n    // Get the ID token from the authentication response\n    const idToken = response.credential;\n\n    // Pass the ID token to fetchUserProfile\n    const userProfile = await fetchUserProfile(idToken);\n    // ...\n\n    try {\n      // Fetch user's profile information from Google API\n      const userProfile = await fetchUserProfile(idToken);\n      // Extract the desired information from the user profile\n      const {\n        email,\n        gender,\n        name\n      } = userProfile;\n      const RegisFormData = {\n        fullName: name,\n        email: email,\n        password: 'No password number',\n        confirmPassword: 'No password number',\n        gender: gender\n        // Rest of the properties...\n      };\n\n      // Replace this URL with the URL of your own backend endpoint\n      // let RegisFormData = {};\n\n      let responseCheckUser;\n      try {\n        responseCheckUser = await axios.get(`${baseURL}/get-employees-accounts/${response.clientId}`);\n      } catch (error) {\n        console.log('User not found', error.message);\n      }\n      if (!responseCheckUser || !responseCheckUser.data) {\n        // Create a new user\n        RegisFormData = {\n          fullName: response.name,\n          email: response.email,\n          password: 'No password number',\n          confirmPassword: 'No password number',\n          gender: response.gender,\n          // If Google API provides it\n          phoneNumber: 'No phone number',\n          address: 'No address number',\n          state: \"verification\",\n          premission: \"Public User\",\n          department: \"No Department\",\n          employeeID: response.clientId,\n          hkID: 'No phone number'\n        };\n\n        // Register the new user\n        let registrationResponse = await registerUser(RegisFormData);\n\n        // Save the JWT to local storage\n        localStorage.setItem('auth-token', registrationResponse.data.token);\n        localStorage.setItem('premission', \"Public User\");\n      } else {\n        // The user already exists\n        let UserData = responseCheckUser.data;\n\n        // Save the JWT to local storage\n        localStorage.setItem('auth-token', UserData.token);\n        localStorage.setItem('premission', UserData.employee.premission);\n      }\n    } catch (err) {\n      console.error(err);\n    }\n  }\n  const registerUser = async RegisFormData => {\n    try {\n      const response = await axios.post(`${baseURL}/create-account`, {\n        // Include other registration data as needed\n        ...RegisFormData\n      });\n      console.log('Registration successful:', response.data);\n      alert('Registration successful!');\n      // Handle successful registration\n\n      // Set isRegistering back to false after the registration process is completed\n      // setIsRegistering(false);\n    } catch (error) {\n      console.error('Registration failed:', error.response.data);\n      alert('Registration failed!');\n      // Handle registration failure\n    }\n  };\n\n  // Init Google client\n  useEffect(() => {\n    /* global google */\n    google.accounts.id.initialize({\n      client_id: \"1061523075573-n537pria7u9k24et8osc54cop29krk3c.apps.googleusercontent.com\",\n      callback: handleCallbackResponse\n    });\n    google.accounts.id.renderButton(document.getElementById(\"signInDiv\"), {\n      theme: \"outline\",\n      size: \"large\"\n    });\n  }, []);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"App\",\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      id: \"signInDiv\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 141,\n      columnNumber: 13\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 140,\n    columnNumber: 9\n  }, this);\n}\n_s(GoogleLogin, \"OD7bBpZva5O2jO+Puf00hKivP7c=\");\n_c = GoogleLogin;\nexport default GoogleLogin;\nvar _c;\n$RefreshReg$(_c, \"GoogleLogin\");","map":{"version":3,"names":["useEffect","axios","baseURL","jsxDEV","_jsxDEV","fetchUserProfile","idToken","response","get","params","personFields","headers","Authorization","email","data","emailAddresses","value","gender","genders","name","names","displayName","error","console","GoogleLogin","_s","handleCallbackResponse","credential","userProfile","RegisFormData","fullName","password","confirmPassword","responseCheckUser","clientId","log","message","phoneNumber","address","state","premission","department","employeeID","hkID","registrationResponse","registerUser","localStorage","setItem","token","UserData","employee","err","post","alert","google","accounts","id","initialize","client_id","callback","renderButton","document","getElementById","theme","size","className","children","fileName","_jsxFileName","lineNumber","columnNumber","_c","$RefreshReg$"],"sources":["/Users/david/Documents/GitHub/web-api/client/src/component/GoogleLogin.js"],"sourcesContent":["import { useEffect } from 'react';\nimport axios from '../commons/axios';\nimport { baseURL } from '../commons/helper';\n\nasync function fetchUserProfile(idToken) {\n    try {\n        const response = await axios.get('https://people.googleapis.com/v1/people/me', {\n            params: {\n                personFields: 'names',\n            },\n            headers: {\n                Authorization: `Bearer ${idToken}`,\n            },\n        });\n\n        // Extract the desired information from the response\n        const email = response.data.emailAddresses[0].value;\n        const gender = response.data.genders[0].value;\n        const name = response.data.names[0].displayName;\n\n        return { email, gender, name };\n    } catch (error) {\n        console.error('Failed to fetch user profile:', error);\n        throw error;\n    }\n}\n\nfunction GoogleLogin() {\n\n    async function handleCallbackResponse(response) {\n        // Get the ID token from the authentication response\n        const idToken = response.credential;\n\n        // Pass the ID token to fetchUserProfile\n        const userProfile = await fetchUserProfile(idToken);\n        // ...\n\n        try {\n            // Fetch user's profile information from Google API\n            const userProfile = await fetchUserProfile(idToken);\n            // Extract the desired information from the user profile\n            const { email, gender, name } = userProfile;\n            const RegisFormData = {\n                fullName: name,\n                email: email,\n                password: 'No password number',\n                confirmPassword: 'No password number',\n                gender: gender,\n                // Rest of the properties...\n            };\n\n\n\n\n\n            // Replace this URL with the URL of your own backend endpoint\n            // let RegisFormData = {};\n\n            let responseCheckUser;\n            try {\n                responseCheckUser = await axios.get(`${baseURL}/get-employees-accounts/${response.clientId}`);\n            } catch (error) {\n                console.log('User not found', error.message);\n            }\n\n\n            if (!responseCheckUser || !responseCheckUser.data) {\n                // Create a new user\n                RegisFormData = {\n                    fullName: response.name,\n                    email: response.email,\n                    password: 'No password number',\n                    confirmPassword: 'No password number',\n                    gender: response.gender, // If Google API provides it\n                    phoneNumber: 'No phone number',\n                    address: 'No address number',\n                    state: \"verification\",\n                    premission: \"Public User\",\n                    department: \"No Department\",\n                    employeeID: response.clientId,\n                    hkID: 'No phone number',\n                };\n\n                // Register the new user\n                let registrationResponse = await registerUser(RegisFormData);\n\n                // Save the JWT to local storage\n                localStorage.setItem('auth-token', registrationResponse.data.token);\n                localStorage.setItem('premission', \"Public User\");\n            } else {\n                // The user already exists\n                let UserData = responseCheckUser.data;\n\n                // Save the JWT to local storage\n                localStorage.setItem('auth-token', UserData.token);\n                localStorage.setItem('premission', UserData.employee.premission);\n            }\n        } catch (err) {\n            console.error(err);\n        }\n    }\n\n    const registerUser = async (RegisFormData) => {\n        try {\n            const response = await axios.post(`${baseURL}/create-account`, {\n                // Include other registration data as needed\n                ...RegisFormData\n            });\n\n            console.log('Registration successful:', response.data);\n            alert('Registration successful!');\n            // Handle successful registration\n\n            // Set isRegistering back to false after the registration process is completed\n            // setIsRegistering(false);\n\n\n        } catch (error) {\n            console.error('Registration failed:', error.response.data);\n            alert('Registration failed!');\n            // Handle registration failure\n        }\n    };\n\n    // Init Google client\n    useEffect(() => {\n        /* global google */\n        google.accounts.id.initialize({\n            client_id: \"1061523075573-n537pria7u9k24et8osc54cop29krk3c.apps.googleusercontent.com\",\n            callback: handleCallbackResponse\n        });\n        google.accounts.id.renderButton(\n            document.getElementById(\"signInDiv\"),\n            { theme: \"outline\", size: \"large\" }\n        )\n    }, []);\n\n\n    return (\n        <div className=\"App\">\n            <div id=\"signInDiv\"></div>\n        </div>\n    );\n}\n\nexport default GoogleLogin;\n"],"mappings":";;AAAA,SAASA,SAAS,QAAQ,OAAO;AACjC,OAAOC,KAAK,MAAM,kBAAkB;AACpC,SAASC,OAAO,QAAQ,mBAAmB;AAAC,SAAAC,MAAA,IAAAC,OAAA;AAE5C,eAAeC,gBAAgBA,CAACC,OAAO,EAAE;EACrC,IAAI;IACA,MAAMC,QAAQ,GAAG,MAAMN,KAAK,CAACO,GAAG,CAAC,4CAA4C,EAAE;MAC3EC,MAAM,EAAE;QACJC,YAAY,EAAE;MAClB,CAAC;MACDC,OAAO,EAAE;QACLC,aAAa,EAAG,UAASN,OAAQ;MACrC;IACJ,CAAC,CAAC;;IAEF;IACA,MAAMO,KAAK,GAAGN,QAAQ,CAACO,IAAI,CAACC,cAAc,CAAC,CAAC,CAAC,CAACC,KAAK;IACnD,MAAMC,MAAM,GAAGV,QAAQ,CAACO,IAAI,CAACI,OAAO,CAAC,CAAC,CAAC,CAACF,KAAK;IAC7C,MAAMG,IAAI,GAAGZ,QAAQ,CAACO,IAAI,CAACM,KAAK,CAAC,CAAC,CAAC,CAACC,WAAW;IAE/C,OAAO;MAAER,KAAK;MAAEI,MAAM;MAAEE;IAAK,CAAC;EAClC,CAAC,CAAC,OAAOG,KAAK,EAAE;IACZC,OAAO,CAACD,KAAK,CAAC,+BAA+B,EAAEA,KAAK,CAAC;IACrD,MAAMA,KAAK;EACf;AACJ;AAEA,SAASE,WAAWA,CAAA,EAAG;EAAAC,EAAA;EAEnB,eAAeC,sBAAsBA,CAACnB,QAAQ,EAAE;IAC5C;IACA,MAAMD,OAAO,GAAGC,QAAQ,CAACoB,UAAU;;IAEnC;IACA,MAAMC,WAAW,GAAG,MAAMvB,gBAAgB,CAACC,OAAO,CAAC;IACnD;;IAEA,IAAI;MACA;MACA,MAAMsB,WAAW,GAAG,MAAMvB,gBAAgB,CAACC,OAAO,CAAC;MACnD;MACA,MAAM;QAAEO,KAAK;QAAEI,MAAM;QAAEE;MAAK,CAAC,GAAGS,WAAW;MAC3C,MAAMC,aAAa,GAAG;QAClBC,QAAQ,EAAEX,IAAI;QACdN,KAAK,EAAEA,KAAK;QACZkB,QAAQ,EAAE,oBAAoB;QAC9BC,eAAe,EAAE,oBAAoB;QACrCf,MAAM,EAAEA;QACR;MACJ,CAAC;;MAMD;MACA;;MAEA,IAAIgB,iBAAiB;MACrB,IAAI;QACAA,iBAAiB,GAAG,MAAMhC,KAAK,CAACO,GAAG,CAAE,GAAEN,OAAQ,2BAA0BK,QAAQ,CAAC2B,QAAS,EAAC,CAAC;MACjG,CAAC,CAAC,OAAOZ,KAAK,EAAE;QACZC,OAAO,CAACY,GAAG,CAAC,gBAAgB,EAAEb,KAAK,CAACc,OAAO,CAAC;MAChD;MAGA,IAAI,CAACH,iBAAiB,IAAI,CAACA,iBAAiB,CAACnB,IAAI,EAAE;QAC/C;QACAe,aAAa,GAAG;UACZC,QAAQ,EAAEvB,QAAQ,CAACY,IAAI;UACvBN,KAAK,EAAEN,QAAQ,CAACM,KAAK;UACrBkB,QAAQ,EAAE,oBAAoB;UAC9BC,eAAe,EAAE,oBAAoB;UACrCf,MAAM,EAAEV,QAAQ,CAACU,MAAM;UAAE;UACzBoB,WAAW,EAAE,iBAAiB;UAC9BC,OAAO,EAAE,mBAAmB;UAC5BC,KAAK,EAAE,cAAc;UACrBC,UAAU,EAAE,aAAa;UACzBC,UAAU,EAAE,eAAe;UAC3BC,UAAU,EAAEnC,QAAQ,CAAC2B,QAAQ;UAC7BS,IAAI,EAAE;QACV,CAAC;;QAED;QACA,IAAIC,oBAAoB,GAAG,MAAMC,YAAY,CAAChB,aAAa,CAAC;;QAE5D;QACAiB,YAAY,CAACC,OAAO,CAAC,YAAY,EAAEH,oBAAoB,CAAC9B,IAAI,CAACkC,KAAK,CAAC;QACnEF,YAAY,CAACC,OAAO,CAAC,YAAY,EAAE,aAAa,CAAC;MACrD,CAAC,MAAM;QACH;QACA,IAAIE,QAAQ,GAAGhB,iBAAiB,CAACnB,IAAI;;QAErC;QACAgC,YAAY,CAACC,OAAO,CAAC,YAAY,EAAEE,QAAQ,CAACD,KAAK,CAAC;QAClDF,YAAY,CAACC,OAAO,CAAC,YAAY,EAAEE,QAAQ,CAACC,QAAQ,CAACV,UAAU,CAAC;MACpE;IACJ,CAAC,CAAC,OAAOW,GAAG,EAAE;MACV5B,OAAO,CAACD,KAAK,CAAC6B,GAAG,CAAC;IACtB;EACJ;EAEA,MAAMN,YAAY,GAAG,MAAOhB,aAAa,IAAK;IAC1C,IAAI;MACA,MAAMtB,QAAQ,GAAG,MAAMN,KAAK,CAACmD,IAAI,CAAE,GAAElD,OAAQ,iBAAgB,EAAE;QAC3D;QACA,GAAG2B;MACP,CAAC,CAAC;MAEFN,OAAO,CAACY,GAAG,CAAC,0BAA0B,EAAE5B,QAAQ,CAACO,IAAI,CAAC;MACtDuC,KAAK,CAAC,0BAA0B,CAAC;MACjC;;MAEA;MACA;IAGJ,CAAC,CAAC,OAAO/B,KAAK,EAAE;MACZC,OAAO,CAACD,KAAK,CAAC,sBAAsB,EAAEA,KAAK,CAACf,QAAQ,CAACO,IAAI,CAAC;MAC1DuC,KAAK,CAAC,sBAAsB,CAAC;MAC7B;IACJ;EACJ,CAAC;;EAED;EACArD,SAAS,CAAC,MAAM;IACZ;IACAsD,MAAM,CAACC,QAAQ,CAACC,EAAE,CAACC,UAAU,CAAC;MAC1BC,SAAS,EAAE,2EAA2E;MACtFC,QAAQ,EAAEjC;IACd,CAAC,CAAC;IACF4B,MAAM,CAACC,QAAQ,CAACC,EAAE,CAACI,YAAY,CAC3BC,QAAQ,CAACC,cAAc,CAAC,WAAW,CAAC,EACpC;MAAEC,KAAK,EAAE,SAAS;MAAEC,IAAI,EAAE;IAAQ,CACtC,CAAC;EACL,CAAC,EAAE,EAAE,CAAC;EAGN,oBACI5D,OAAA;IAAK6D,SAAS,EAAC,KAAK;IAAAC,QAAA,eAChB9D,OAAA;MAAKoD,EAAE,EAAC;IAAW;MAAAW,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAAM;EAAC;IAAAH,QAAA,EAAAC,YAAA;IAAAC,UAAA;IAAAC,YAAA;EAAA,OACzB,CAAC;AAEd;AAAC7C,EAAA,CApHQD,WAAW;AAAA+C,EAAA,GAAX/C,WAAW;AAsHpB,eAAeA,WAAW;AAAC,IAAA+C,EAAA;AAAAC,YAAA,CAAAD,EAAA"},"metadata":{},"sourceType":"module","externalDependencies":[]}